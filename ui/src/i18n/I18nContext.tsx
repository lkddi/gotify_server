import React from 'react';

export type Locale = 'zh' | 'en';

type Dict = Record<string, string>;

const translations: Record<Locale, Dict> = {
    zh: {
        'header.menu': '菜单',
        'header.users': '用户',
        'header.apps': '应用',
        'header.clients': '客户端',
        'header.plugins': '插件',
        'header.logout': '退出登录',
        'nav.allMessages': '全部消息',
        'nav.enableNotifications': '启用通知',
        'nav.placeholderServer1': '某服务器',
        'nav.placeholderServer2': '树莓派',
        'settings.changePassword': '更改密码',
        'settings.newPassword': '新密码 *',
        'settings.cancel': '取消',
        'settings.passwordRequired': '需要密码',
        'settings.change': '更改',
        'login.title': '登录',
        'login.register': '注册',
        'login.username': '用户名',
        'login.password': '密码',
        'login.login': '登录',
        'lang.zh': '中文',
        'lang.en': 'English',
        'apps.title': '应用',
        'apps.create': '创建应用',
        'apps.col.name': '名称',
        'apps.col.token': '令牌',
        'apps.col.description': '描述',
        'apps.col.priority': '优先级',
        'apps.col.lastUsed': '最近使用',
        'apps.dialog.createTitle': '创建应用',
        'apps.dialog.updateTitle': '更新应用',
        'apps.dialog.help': '应用拥有发送消息的权限。',
        'apps.dialog.name': '名称 *',
        'apps.dialog.shortDesc': '简短描述',
        'apps.dialog.defaultPriority': '默认优先级',
        'common.cancel': '取消',
        'common.required.name': '需要名称',
        'common.create': '创建',
        'common.update': '更新',
        'apps.confirm.deleteTitle': '确认删除',
        'apps.confirm.deleteText': '删除 {name}？',
        'apps.confirm.deleteImageTitle': '确认删除图片',
        'apps.confirm.deleteImageText': '删除 {name} 的图片？',
        'apps.tooltip.deleteImage': '删除图片',
        'apps.alt.logo': '应用图标',
        'clients.title': '客户端',
        'clients.create': '创建客户端',
        'clients.col.name': '名称',
        'clients.col.token': '令牌',
        'clients.col.lastUsed': '最近使用',
        'clients.dialog.createTitle': '创建客户端',
        'clients.dialog.updateTitle': '更新客户端',
        'clients.dialog.help': '客户端可管理消息、客户端、应用与用户（需管理员权限）。',
        'users.title': '用户',
        'users.create': '创建用户',
        'users.col.username': '用户名',
        'users.col.admin': '管理员',
        'users.row.admin.yes': '是',
        'users.row.admin.no': '否',
        'users.dialog.addTitle': '添加用户',
        'users.dialog.editTitle': '编辑 {name}',
        'users.dialog.username': '用户名 *',
        'users.dialog.password': '密码 *',
        'users.dialog.passwordEdit': '密码（不修改则留空）',
        'users.dialog.adminRights': '拥有管理员权限',
        'common.required.password': '需要密码',
        'common.required.username': '需要用户名',
        'common.save': '保存',
        'messages.reachedEnd': '已到列表末尾',
        'messages.empty': '暂无消息',
        'messages.refresh': '刷新',
        'messages.deleteAll': '全部删除',
        'common.confirm.deleteTitle': '确认删除',
        'messages.confirm.deleteAll': '删除全部消息？',
        'plugins.title': '插件',
        'plugins.col.id': 'ID',
        'plugins.col.enabled': '已启用',
        'plugins.col.name': '名称',
        'plugins.col.token': '令牌',
        'plugins.col.details': '详情',
        'confirm.no': '取消',
        'confirm.yes': '确定',
        'copy.tooltip': '复制到剪贴板',
        'copy.success': '已复制到剪贴板',
        'copy.fail': '复制失败',
    },
    en: {
        'header.menu': 'menu',
        'header.users': 'users',
        'header.apps': 'apps',
        'header.clients': 'clients',
        'header.plugins': 'plugins',
        'header.logout': 'Logout',
        'nav.allMessages': 'All Messages',
        'nav.enableNotifications': 'Enable Notifications',
        'nav.placeholderServer1': 'Some Server',
        'nav.placeholderServer2': 'A Raspberry PI',
        'settings.changePassword': 'Change Password',
        'settings.newPassword': 'New Password *',
        'settings.cancel': 'Cancel',
        'settings.passwordRequired': 'Password is required',
        'settings.change': 'Change',
        'login.title': 'Login',
        'login.register': 'Register',
        'login.username': 'Username',
        'login.password': 'Password',
        'login.login': 'Login',
        'lang.zh': '中文',
        'lang.en': 'English',
        'apps.title': 'Applications',
        'apps.create': 'Create Application',
        'apps.col.name': 'Name',
        'apps.col.token': 'Token',
        'apps.col.description': 'Description',
        'apps.col.priority': 'Priority',
        'apps.col.lastUsed': 'Last Used',
        'apps.dialog.createTitle': 'Create an application',
        'apps.dialog.updateTitle': 'Update an application',
        'apps.dialog.help': 'An application is allowed to send messages.',
        'apps.dialog.name': 'Name *',
        'apps.dialog.shortDesc': 'Short Description',
        'apps.dialog.defaultPriority': 'Default Priority',
        'common.cancel': 'Cancel',
        'common.required.name': 'name is required',
        'common.create': 'Create',
        'common.update': 'Update',
        'apps.confirm.deleteTitle': 'Confirm Delete',
        'apps.confirm.deleteText': 'Delete {name}?',
        'apps.confirm.deleteImageTitle': 'Confirm Delete Image',
        'apps.confirm.deleteImageText': 'Delete image for {name}?',
        'apps.tooltip.deleteImage': 'Delete image',
        'apps.alt.logo': 'app logo',
        'clients.title': 'Clients',
        'clients.create': 'Create Client',
        'clients.col.name': 'Name',
        'clients.col.token': 'Token',
        'clients.col.lastUsed': 'Last Used',
        'clients.dialog.createTitle': 'Create a client',
        'clients.dialog.updateTitle': 'Update a Client',
        'clients.dialog.help': 'A client manages messages, clients, applications and users (with admin permissions).',
        'users.title': 'Users',
        'users.create': 'Create User',
        'users.col.username': 'Username',
        'users.col.admin': 'Admin',
        'users.row.admin.yes': 'Yes',
        'users.row.admin.no': 'No',
        'users.dialog.addTitle': 'Add a user',
        'users.dialog.editTitle': 'Edit {name}',
        'users.dialog.username': 'Username *',
        'users.dialog.password': 'Password *',
        'users.dialog.passwordEdit': 'Password (empty if no change)',
        'users.dialog.adminRights': 'has administrator rights',
        'common.required.password': 'password is required',
        'common.required.username': 'username is required',
        'common.save': 'Save',
        'messages.reachedEnd': "You've reached the end",
        'messages.empty': 'No messages',
        'messages.refresh': 'Refresh',
        'messages.deleteAll': 'Delete All',
        'common.confirm.deleteTitle': 'Confirm Delete',
        'messages.confirm.deleteAll': 'Delete all messages?',
        'plugins.title': 'Plugins',
        'plugins.col.id': 'ID',
        'plugins.col.enabled': 'Enabled',
        'plugins.col.name': 'Name',
        'plugins.col.token': 'Token',
        'plugins.col.details': 'Details',
        'confirm.no': 'No',
        'confirm.yes': 'Yes',
        'copy.tooltip': 'Copy to clipboard',
        'copy.success': 'Copied to clipboard',
        'copy.fail': 'Failed to copy to clipboard',
    },
};

export const I18nContext = React.createContext<{
    locale: Locale;
    setLocale: (l: Locale) => void;
    t: (key: string) => string;
}>({
    locale: 'zh',
    setLocale: () => {},
    t: (key) => key,
});

export const I18nProvider: React.FC<React.PropsWithChildren<{ defaultLocale?: Locale }>> = ({
    children,
    defaultLocale = 'zh',
}) => {
    const [locale, setLocale] = React.useState<Locale>(() => {
        const stored = window.localStorage.getItem('gotify-lang');
        return stored === 'en' || stored === 'zh' ? (stored as Locale) : defaultLocale;
    });
    const t = React.useCallback((key: string) => {
        const dict = translations[locale] || translations.zh;
        return dict[key] ?? key;
    }, [locale]);
    const value = React.useMemo(() => ({locale, setLocale: (l: Locale) => {
        window.localStorage.setItem('gotify-lang', l);
        setLocale(l);
    }, t}), [locale]);
    return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
};

export const useI18n = () => React.useContext(I18nContext);
